<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡Œé‚Šé»é¤ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-bottom: 80px; }
        .menu-item { background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; border: 1px solid #e9ecef; }
        .price-tag { color: #0d6efd; font-weight: bold; font-size: 1.1rem; }
        .sticky-footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; padding: 15px; border-top: 1px solid #ddd;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1); text-align: center;
        }
        .section-title { font-weight: bold; margin: 20px 0 10px 0; display: flex; align-items: center; }
        .icon { margin-right: 5px; }
    </style>
</head>
<body>

<div class="container mt-3">
    <h3>ğŸ“± æ¡Œé‚Šé»é¤ (æ¡Œè™Ÿ: T00)</h3>

    <div class="section-title">ğŸ² èœå–® Menu</div>
    <div id="menu-container">
        </div>

    <div class="section-title">ğŸ›’ æ‚¨çš„è¨‚å–®</div>
    <div class="card p-3 mb-3 bg-light text-center text-muted" id="empty-cart-msg">
        ç›®å‰æ²’æœ‰é»é¸ä»»ä½•é¤é»ã€‚
    </div>
    <ul class="list-group mb-3" id="cart-list" style="display:none;">
        </ul>
</div>

<div class="sticky-footer">
    <button class="btn btn-success w-100 btn-lg" onclick="submitOrder()">
        âœ… ç¢ºèªé€å‡ºè¨‚å–® (<span id="total-price">0</span> å…ƒ)
    </button>
</div>

<script>
    // 1. æ¨¡æ“¬å¾Œå°è³‡æ–™åº«ï¼šé€™è£¡æ˜¯ç®¡ç†å“¡è¨­å®šçš„èœå–®
    const menuData = [
        { id: 1, name: "ç‰›è‚‰éºµ", price: 120, placeholder: "å®¢è£½åŒ– (ä¾‹: å°‘éºµã€ä¸è”¥)" },
        { id: 2, name: "å•¤é…’", price: 150, placeholder: "å‚™è¨» (ä¾‹: è¦å†°æ¯)" },
        { id: 3, name: "æ¿ƒæ¹¯", price: 60, placeholder: "å‚™è¨» (ä¾‹: å¤šèƒ¡æ¤’)" },
        { id: 4, name: "å¯æ¨‚", price: 30, placeholder: "" },
        { id: 5, name: "é¦™è’œéºµåŒ…", price: 45, placeholder: "" }
    ];

    // å„²å­˜å®¢äººçš„é¸æ“‡
    let cart = {}; 

    // 2. åˆå§‹åŒ–ï¼šå°‡èœå–®ç•«åˆ°ç¶²é ä¸Š
    function renderMenu() {
        const container = document.getElementById('menu-container');
        let html = '';
        menuData.forEach(item => {
            html += `
            <div class="menu-item">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="m-0">${item.name}</h5>
                    <span class="price-tag">NT$${item.price}</span>
                </div>
                
                <div class="row align-items-center mb-2">
                    <div class="col-auto">æ•¸é‡:</div>
                    <div class="col">
                        <input type="number" class="form-control" min="0" value="0" 
                            onchange="updateCart(${item.id}, this.value)">
                    </div>
                </div>

                <input type="text" class="form-control form-control-sm" 
                    id="note-${item.id}" 
                    placeholder="${item.placeholder || 'è«‹è¼¸å…¥éœ€æ±‚...'}" 
                    oninput="updateNote(${item.id}, this.value)">
            </div>
            `;
        });
        container.innerHTML = html;
    }

    // 3. æ›´æ–°è³¼ç‰©è»Šé‚è¼¯
    function updateCart(id, qty) {
        qty = parseInt(qty);
        if (qty > 0) {
            if (!cart[id]) {
                // å¦‚æœè³¼ç‰©è»Šæ²’é€™å€‹å•†å“ï¼Œå¾ menuData æ‰¾è³‡æ–™
                const product = menuData.find(p => p.id === id);
                cart[id] = { ...product, qty: qty, note: "" };
            } else {
                cart[id].qty = qty;
            }
        } else {
            delete cart[id]; // æ•¸é‡ç‚º 0 å‰‡ç§»é™¤
        }
        renderCartSummary();
    }

    // æ›´æ–°å‚™è¨»
    function updateNote(id, text) {
        if (cart[id]) {
            cart[id].note = text;
        }
    }

    // 4. æ¸²æŸ“åº•éƒ¨è¨‚å–®æ‘˜è¦èˆ‡ç¸½é‡‘é¡
    function renderCartSummary() {
        const list = document.getElementById('cart-list');
        const emptyMsg = document.getElementById('empty-cart-msg');
        const totalSpan = document.getElementById('total-price');
        
        list.innerHTML = '';
        let total = 0;
        let hasItems = false;

        for (let key in cart) {
            hasItems = true;
            const item = cart[key];
            const subtotal = item.price * item.qty;
            total += subtotal;
            
            list.innerHTML += `
                <li class="list-group-item d-flex justify-content-between lh-sm">
                    <div>
                        <h6 class="my-0">${item.name} x ${item.qty}</h6>
                        <small class="text-muted">${item.note ? 'å‚™è¨»: ' + item.note : ''}</small>
                    </div>
                    <span class="text-muted">$${subtotal}</span>
                </li>
            `;
        }

        totalSpan.innerText = total;
        
        if (hasItems) {
            emptyMsg.style.display = 'none';
            list.style.display = 'block';
        } else {
            emptyMsg.style.display = 'block';
            list.style.display = 'none';
        }
    }

    // 5. é€å‡ºè¨‚å–® (ç›®å‰åƒ…æ˜¯ç”¨ alert é¡¯ç¤ºï¼Œå¯¦éš›éœ€è¦é€£æ¥å¾Œç«¯)
    function submitOrder() {
        if (Object.keys(cart).length === 0) {
            alert("è«‹å…ˆé¸æ“‡é¤é»å–”ï¼");
            return;
        }
        console.log("é€å‡ºçš„è¨‚å–®è³‡æ–™:", cart);
        alert("è¨‚å–®å·²é€å‡ºï¼å»šæˆ¿æº–å‚™ä¸­...\n(è©³ç´°è³‡æ–™è«‹çœ‹ F12 Console)");
        // é€™è£¡æœªä¾†æœƒå¯«å…¥: fetch('api/order', { method: 'POST', body: ... })
    }

    // å•Ÿå‹•ç¨‹å¼
    renderMenu();
</script>

</body>
</html>